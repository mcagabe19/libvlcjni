name: CI

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout libvlcjni
        uses: actions/checkout@main
      - name: Setup Android NDK
        uses: nttld/setup-ndk@main
        id: setup-ndk
        with:
          ndk-version: r21e
      - name: Setup Java JDK
        uses: actions/setup-java@main
        with:
          distribution: 'temurin'
          java-version: '11'
      - name: Setup libLVC
        run: | 
           DEBIAN_FRONTEND=noninteractive sudo apt-get -qq install -o Dpkg::Progress-Fancy="0" -o APT::Color="0" -o Dpkg::Use-Pty="0" gettext autopoint automake ant autopoint cmake build-essential libtool-bin lua5.2 liblua5.2-dev patch pkg-config protobuf-compiler ragel subversion unzip git flex python3 wget nasm meson ninja-build < /dev/null > /dev/null && git config --global user.name "GitHub Actions" && git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com" && ./buildsystem/get-vlc.sh
           mkdir vlc/contrib/aarch64-linux-android
           mkdir vlc/contrib/aarch64-linux-android/lib
           sudo ln -s /usr/lib/x86_64-linux-gnu/liblua5.2.a /home/runner/work/libvlcjni/libvlcjni/vlc/contrib/aarch64-linux-android/lib/liblua.a
      - name: Compile libVLC
        run: ./buildsystem/compile-libvlc.sh -a arm64 --no-jni
        env:
           MAKEFLAGS: -j8
           ANDROID_NDK_HOME: ${{ steps.setup-ndk.outputs.ndk-path }}
           ANDROID_NDK: ${{ steps.setup-ndk.outputs.ndk-path }}
      - name: ignore
        run: find | grep libvlc
